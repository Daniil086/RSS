# RSS PoC Loader Connector

## Обзор

RSS PoC Loader Connector — это специализированный коннектор для OpenCTI, который автоматически собирает Proof-of-Concept файлы из GitHub репозиториев через RSS-ленты и преобразует их в STIX-объекты. Коннектор работает в двух режимах: bootstrap (первичная загрузка) и мониторинг (постоянное отслеживание новых записей).

## Основная функциональность

### Источники данных
- **RSS-лента**: `https://poc-in-github.motikan2010.net/rss/`
- **GitHub репозитории**: автоматическое клонирование PoC репозиториев
- **NVD API**: получение метаданных уязвимостей и CVSS-оценок

### Обрабатываемые типы файлов
Коннектор фильтрует файлы по расширениям и именам, исключая:
- Медиафайлы (изображения, видео, аудио)
- Документацию (README, LICENSE, CHANGELOG)
- Конфигурационные файлы
- Временные и системные файлы

**Поддерживаемые файлы**: исполняемые скрипты, исходный код, бинарные файлы PoC

### Создаваемые STIX-объекты

#### 1. Artifacts (Артефакты)
- **Содержимое**: PoC файлы из репозиториев
- **Метаданные**: SHA256 хеши, размер, относительный путь
- **Привязки**: к Tool и Vulnerability объектам

#### 2. Tools (Инструменты)
- **Описание**: PoC инструменты для эксплуатации уязвимостей
- **Метаданные**: версия, автор, репозиторий
- **Привязки**: к Identity (автор) и Vulnerability
- **Вложения**: архив репозитория в формате .tar.gz

#### 3. Vulnerabilities (Уязвимости)
- **Источник**: автоматическое извлечение CVE-ID из названий репозиториев
- **Обогащение**: данные из NVD API (описание, CVSS-оценки, даты)
- **Ссылки**: автоматическое создание External Reference на NVD
- **Маркировка**: TLP:RED и PAP:RED

#### 4. Identities (Идентичности)
- **Авторы**: владельцы GitHub репозиториев
- **Метки**: автоматическое создание и кеширование

#### 5. External References
- **GitHub**: ссылки на исходные репозитории
- **NVD**: официальные ссылки на уязвимости

### Система лейблов (Labels)

Коннектор автоматически создает и управляет системой лейблов для категоризации и поиска объектов:

#### Автоматически создаваемые лейблы
- **PoC** (`#2196F3` - синий): основной лейбл для всех Proof-of-Concept объектов
- **CVE-XXXX-XXXX** (уникальный цвет): автоматически генерируется для каждой уязвимости
- **Author Name** (уникальный цвет): лейбл для авторов GitHub репозиториев
- **Empty Repository** (`#9E9E9E` - серый): для репозиториев без подходящих PoC файлов

#### Генерация цветов
- **CVE лейблы**: цвет генерируется из MD5 хеша CVE-ID для уникальности
- **Авторские лейблы**: цвет генерируется из MD5 хеша имени автора
- **Системные лейблы**: фиксированные цвета для стандартных категорий

#### Кеширование лейблов
- **В памяти**: кеширование ID лейблов для быстрого доступа
- **Автоматическое создание**: лейблы создаются при первом использовании
- **Переиспользование**: существующие лейблы используются повторно

## Архитектура и компоненты

### Основные модули
- **RSSConnector**: главный класс, управляющий процессом
- **RSSClient**: клиент для работы с RSS-лентами
- **GraphQLConverter**: конвертер в STIX-объекты через GraphQL API
- **LogRotator**: система ротации логов
- **ConfigConnector**: загрузчик конфигурации

### Система кеширования
- **Файловый кеш**: `poc_cache.json` с метаданными обработанных записей
- **Кеш меток**: кеширование Label и Identity объектов
- **Автоочистка**: удаление записей старше 30 дней

### Обработка ошибок и повторные попытки
- **NVD API**: до 3 попыток с экспоненциальной задержкой
- **Git клонирование**: повторные попытки при таймаутах
- **Rate limiting**: соблюдение ограничений NVD API

## Режимы работы

### Bootstrap режим
- **Триггер**: первый запуск или неполная инициализация
- **Обработка**: до 10 записей RSS (настраивается)
- **Work**: создание отдельного work для каждого репозитория
- **Цель**: первичная загрузка исторических данных

### Мониторинг режим
- **Триггер**: после завершения bootstrap
- **Обработка**: только новые записи RSS
- **Work**: создание work только для новых репозиториев
- **Интервал**: каждые 10 минут (настраивается)

## Система логирования

### Уровни логирования
- **INFO**: основные операции, создание объектов
- **WARNING**: некритичные ошибки, отсутствие данных
- **ERROR**: критические ошибки, сбои API

### Ротация логов
- **Интервал**: 24 часа (настраивается)
- **Метод**: очистка файла с сохранением метаданных
- **Путь**: `/opt/opencti-rss-connector/connector.log`

### Метрики
- **Счетчики**: обработанные записи, клонированные репозитории, созданные объекты
- **Состояния**: idle, running
- **Ошибки**: общее количество ошибок, cache hit/miss
- **Лейблы**: количество созданных и переиспользованных лейблов

## Конфигурация

### Основные параметры
- **Интервал выполнения**: PT10M (10 минут)
- **Bootstrap count**: 10 записей
- **Размер файлов**: от 10 байт до 50MB
- **TLP уровень**: RED (по умолчанию)

### NVD API настройки
- **Максимум попыток**: 3
- **Базовая задержка**: 2 секунды
- **Задержка между запросами**: 5 секунд

### Фильтры исключения
- **Расширения**: 50+ типов файлов (изображения, документы, конфиги)
- **Имена**: README, LICENSE, CHANGELOG, .gitignore
- **Директории**: .git, node_modules, __pycache__, dist

## Интеграция с OpenCTI

### API взаимодействие
- **GraphQL API**: создание и обновление объектов
- **Work API**: отслеживание прогресса операций
- **Metrics API**: отправка метрик и состояний

### Безопасность
- **Аутентификация**: API токен OpenCTI
- **Маркировка**: автоматическое применение TLP:RED и PAP:RED
- **Изоляция**: отдельная рабочая директория для загрузок

### Производительность
- **Асинхронность**: неблокирующая обработка
- **Кеширование**: минимизация повторных API вызовов
- **Очистка**: автоматическое удаление временных файлов

## Результаты работы

### Типичный вывод за сессию
- **RSS записи**: 10-50+ записей
- **Репозитории**: автоматическое клонирование
- **STIX объекты**: 20-100+ объектов (Artifacts, Tools, Vulnerabilities)
- **Связи**: автоматическое создание отношений между объектами
- **Вложения**: архивы репозиториев для каждого Tool

### Качество данных
- **Автоматическое обогащение**: NVD данные, CVSS-оценки
- **Валидация**: проверка CVE-ID, фильтрация файлов
- **Связность**: полная связная граф-модель угроз
- **Актуальность**: регулярное обновление через RSS-ленты
- **Категоризация**: автоматическая система лейблов для поиска и фильтрации